# run_pipeline.py

import sys
import os

# ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° Root Directory ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô System Path ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ import ‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ
# (‡∏Å‡∏£‡∏ì‡∏µ‡∏£‡∏±‡∏ô‡∏à‡∏≤‡∏Å Root Directory)
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

# ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô
# *‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå .py ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô*
try:
    from ingest import ingest_data
    from transform import transform_data
    from publish import run_publication_pipeline 
except ImportError as e:
    print(f"!!! ERROR: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô: {e} !!!")
    print("‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå 'ingest.py', 'transform.py', ‡πÅ‡∏•‡∏∞ 'publish.py' ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô")
    sys.exit(1)


def run_full_pipeline():
    """
    ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡πÑ‡∏õ‡∏õ‡πå‡πÑ‡∏•‡∏ô‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö End-to-End
    """
    print("\n=======================================================")
    print("        üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Data Pipeline (E-T-L) üöÄ")
    print("=======================================================\n")
    
    # --- STEP 1: INGESTION (‡∏î‡∏∂‡∏á‡πÅ‡∏•‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö) ---
    print("\n--- [1/3] INGESTION: ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Kaggle (CSV) ‡πÄ‡∏Ç‡πâ‡∏≤ PostgreSQL ---")
    try:
        ingest_data()
        print("\n[SUCCESS] ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô INGESTION ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô")
    except Exception as e:
        print(f"\n!!! [FAILED] ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô INGESTION ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: {e}")
        return # ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
    
    # --- STEP 2: TRANSFORMATION (‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏£‡∏£‡∏π‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) ---
    print("\n--- [2/3] TRANSFORMATION: ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô PostgreSQL ---")
    try:
        transform_data()
        print("\n[SUCCESS] ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô TRANSFORMATION ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô")
    except Exception as e:
        print(f"\n!!! [FAILED] ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô TRANSFORMATION ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: {e}")
        return
    
    # --- STEP 3: PUBLICATION (‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets) ---
    print("\n--- [3/3] PUBLICATION: ‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets ---")
    try:
        run_publication_pipeline()
        print("\n[SUCCESS] ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô PUBLICATION ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô")
    except Exception as e:
        print(f"\n!!! [FAILED] ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô PUBLICATION ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: {e}")
        return
        
    print("\n=======================================================")
    print("          üéâ Data Pipeline ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå üéâ")
    print("=======================================================\n")


if __name__ == "__main__":
    run_full_pipeline()